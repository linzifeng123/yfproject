var itemSpec=function(){var e,t,n,r,i,s=function(r){i=_.pluck(r.spuSpecifications,"globalId");var s=_.values(n),o=[];_.map(r.spuSpecifications,function(e){var t=_.uniq(_.pluck(s,e.globalId));e.values=_.filter(e.values,function(e){return _.contains(t,e.globalId)}),_.map(t,function(t){o.push([e.globalId,t].join("_"))})}),e=r.spuSpecifications;var u=_.map(s,function(e){return _.map(_.pairs(e),function(e){return e.join("_")})});t={},_.each(o,function(e){var n=_.filter(u,function(t){return _.contains(t,e)});t[e]=_.uniq(_.flatten(n))})},o=function(){e&&$.each(e,function(e,t){var n=$('<div class="cate"><span class="cate-label">'+t.name+'</span><ul class="cate-list" data-catename="'+t.globalId+'"></ul></div>'),r=n.find(".cate-list");$.each(t.values,function(e,n){r.append('<li class="cate-item"><a href="javascript:;" data-catevalue="'+t.globalId+"_"+n.globalId+'">'+n.value+"</a></li>")}),r.append('<li class="cate-tips"><i class="cate-icon"></i>\u8bf7\u9009\u62e9'+t.name+"</li>"),n.appendTo("#item-cate")})},u=function(e,t){var n=_.map(_.pairs(e),function(e){return e.join("_")});if(i.length>1){var r=t&&[t,e[t]].join(["_"]);p(n,r)}var s=$(".cate-item").not(".disable");$.each(s,function(e,t){var r=$(t).find("a").data("catevalue");_.contains(n,r)&&$(t).addClass("cur")}),l()},a=function(e){var t=h(),n=e.split("_"),r=n[0],s=n[1];t[r]=s;var o=f(t);if(o){if(_.size(t)==i.length){location.href="/shop/item?item_id="+o;return}}else t={},t[r]=s;u(t,r)},f=function(e){e||(e=h());var t=_.findKey(n,e);return r[t]},l=function(){var e=!0;return $(".cate").each(function(){$(this).find(".cate-list .cur:not(.disable)").length?$(this).removeClass("needselect"):(e=!1,$(this).addClass("needselect"))}),e},c=function(n,r){var i=[],s=[],o=[],u=$.map(n,function(e){return e.split("_")[0]});return _.map(n,function(e){o.push(t[e])}),i=_.uniq(_.flatten(o)),u.length==1?e&&_.each(e,function(e){e.globalId==u[0]&&_.each(e.values,function(t){s.push(e.globalId+"_"+t.globalId)})}):(s=_.reduce(o,function(e,t,n){return _.intersection(e,t)}),i=_.filter(i,function(e){return _.contains(u,e.split("_")[0])})),conCateLists=i.concat(s),_.uniq(conCateLists)},h=function(){var e={};return $(".cate-item.cur").not(".disable").each(function(){var t=$(this).find("a").data("catevalue"),n=t.split("_");e[n[0]]=n[1]}),e},p=function(e,t){var n=c(e,t);$(".cate-list .cate-item").addClass("disable").removeClass("cur");var r=$(".cate-item");$.each(r,function(e,t){var r=$(t).find("a").data("catevalue");_.contains(n,r)&&$(t).removeClass("disable")})},d=function(){$(".cate-list .cate-item").on("click",function(e){if(!$(this).hasClass("cur")){var t=$(this).find("a").data("catevalue");a(t)}})},v=function(t){n={},_.each(t.specificationItemMap,function(e,r){n[r]=t.specificationKeys[r]}),r=t.specificationItemMap;var i=t.specificationKey;s(t);if(!e)return;o(),i&&u(n[i]),d()};return{init:v,getItemid:f}}();window.itemSpec=itemSpec;